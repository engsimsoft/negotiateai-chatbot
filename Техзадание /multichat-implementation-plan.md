# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º—É–ª—å—Ç–∏—á–∞—Ç–∞ –¥–ª—è NegotiateAI Chatbot

**–°—Ç–∞—Ç—É—Å:** –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ MVP (Phase 5)
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-14
**–í–µ—Ä—Å–∏—è:** 1.0
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** High (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 1-4)

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#—Ç–µ–∫—É—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#—Ü–µ–ª–µ–≤–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
4. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
5. [–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–ø–ª–∞–Ω-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
6. [–°—Ö–µ–º–∞ –ë–î](#—Å—Ö–µ–º–∞-–±–¥)
7. [API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã](#api-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
8. [UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#ui-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
9. [–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏](#–æ—Ü–µ–Ω–∫–∞-–≤—Ä–µ–º–µ–Ω–∏)
10. [–†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è](#—Ä–∏—Å–∫–∏-–∏-–º–∏—Ç–∏–≥–∞—Ü–∏—è)
11. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
12. [–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö](#–º–∏–≥—Ä–∞—Ü–∏—è-–¥–∞–Ω–Ω—ã—Ö)

---

## üéØ –û–±–∑–æ—Ä

### –ü—Ä–æ–±–ª–µ–º–∞
–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —á–∞—Ç-–±–æ—Ç–∞ (MVP):
- –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Å–µ—Å—Å–∏—è —á–∞—Ç–∞
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (useChat state)
- –ü—Ä–∏ refresh —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è —Ç–µ—Ä—è–µ—Ç—Å—è
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä—ã–º —Ä–∞–∑–≥–æ–≤–æ—Ä–∞–º
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –æ–∫–Ω–æ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—å—Å—è –ø—Ä–∏ –¥–ª–∏–Ω–Ω–æ–º –¥–∏–∞–ª–æ–≥–µ

### –†–µ—à–µ–Ω–∏–µ
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –º—É–ª—å—Ç–∏—á–∞—Ç–∞ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å Claude.ai:
- –°–∞–π–¥–±–∞—Ä —Å–æ —Å–ø–∏—Å–∫–æ–º –≤—Å–µ—Ö —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–Ω–æ–ø–∫–∞ "New chat" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
- –ö–∞–∂–¥—ã–π —á–∞—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î —Å –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏
- –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π —á–∞—Ç–æ–≤
- –û–ø–µ—Ä–∞—Ü–∏–∏: —É–¥–∞–ª–µ–Ω–∏–µ, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –∞—Ä—Ö–∏–≤–∞—Ü–∏—è —á–∞—Ç–æ–≤

### –ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω–Ω–æ—Å—Ç—å
1. **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã:** –†–∞–∑–Ω—ã–µ —á–∞—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω/–ø—Ä–æ–µ–∫—Ç–æ–≤
2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏:** –î–æ—Å—Ç—É–ø –∫ —Å—Ç–∞—Ä—ã–º –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∞–º –∏ —Ä–µ—à–µ–Ω–∏—è–º
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
4. **UX:** –ü—Ä–∏–≤—ã—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–∫–∞–∫ ChatGPT, Claude.ai)
5. **–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:** –ö–∞–∂–¥—ã–π —á–∞—Ç = –Ω–æ–≤–æ–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –æ–∫–Ω–æ

---

## üìä –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (MVP)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Browser (Next.js Client)        ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ       app/page.tsx                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  useChat() hook                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ messages: []  (in-memory)     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ sendMessage()                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ status                        ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                 ‚îÇ                       ‚îÇ
‚îÇ                 ‚ñº                       ‚îÇ
‚îÇ         HTTP POST /api/chat             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Server (Next.js API Route)         ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ    app/api/chat/route.ts          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  streamText()                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ toUIMessageStreamResponse()   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                 ‚îÇ                       ‚îÇ
‚îÇ                 ‚ñº                       ‚îÇ
‚îÇ         Anthropic API                   ‚îÇ
‚îÇ       (Claude Sonnet 4.5)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü–†–û–ë–õ–ï–ú–´:
‚ùå –ò—Å—Ç–æ—Ä–∏—è –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (—Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ refresh)
‚ùå –ù–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
‚ùå –û–¥–∏–Ω —á–∞—Ç = –æ–¥–Ω–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –æ–∫–Ω–æ (–º–æ–∂–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—å—Å—è)
‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä—ã–º —Ä–∞–∑–≥–æ–≤–æ—Ä–∞–º
```

---

## üèóÔ∏è –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Å –º—É–ª—å—Ç–∏—á–∞—Ç–æ–º)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Browser (Next.js Client)                        ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Sidebar      ‚îÇ  ‚îÇ      ChatWindow                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                ‚îÇ  ‚îÇ                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ New Chat [+]   ‚îÇ  ‚îÇ  useChat({ id: chatId })         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                ‚îÇ  ‚îÇ  ‚îú‚îÄ messages: []                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Chat List:     ‚îÇ  ‚îÇ  ‚îú‚îÄ sendMessage()                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ  ‚îî‚îÄ status                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Chat 1  ‚úì  ‚îÇ ‚îÇ  ‚îÇ                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Chat 2     ‚îÇ ‚îÇ  ‚îÇ  Message List                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Chat 3     ‚îÇ ‚îÇ  ‚îÇ  Input Form                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îÇ                ‚îÇ                                         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                         ‚îÇ
‚îÇ         ‚îÇ                          ‚îÇ                        ‚îÇ
‚îÇ         ‚ñº                          ‚ñº                        ‚îÇ
‚îÇ   GET /api/chats          POST /api/chat?chatId=xxx         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ                          ‚îÇ
                ‚ñº                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Server (Next.js API Routes)                     ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  /api/chats         ‚îÇ    ‚îÇ  /api/chat               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                     ‚îÇ    ‚îÇ                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  GET - —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ ‚îÇ    ‚îÇ  POST - –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  POST - –Ω–æ–≤—ã–π —á–∞—Ç   ‚îÇ    ‚îÇ  ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  DELETE - —É–¥–∞–ª–∏—Ç—å   ‚îÇ    ‚îÇ  ‚îî‚îÄ –í—ã–∑–≤–∞—Ç—å Claude       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  PATCH - –æ–±–Ω–æ–≤–∏—Ç—å   ‚îÇ    ‚îÇ  ‚îî‚îÄ –í–µ—Ä–Ω—É—Ç—å stream       ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ              ‚îÇ                          ‚îÇ                    ‚îÇ
‚îÇ              ‚ñº                          ‚ñº                    ‚îÇ
‚îÇ         Supabase Client           Anthropic API              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Supabase (PostgreSQL)                      ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  chats                                             ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ id (uuid, PK)                                  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ title (text)                                   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ user_id (uuid, FK) - –¥–ª—è –±—É–¥—É—â–µ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ created_at (timestamp)                         ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ updated_at (timestamp)                         ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                          ‚îÇ                                   ‚îÇ
‚îÇ                          ‚îÇ 1:N                               ‚îÇ
‚îÇ                          ‚ñº                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  messages                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ id (uuid, PK)                                  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ chat_id (uuid, FK)                             ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ role (text) - 'user' | 'assistant'            ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ content (text)                                 ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ created_at (timestamp)                         ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ metadata (jsonb) - –¥–ª—è tool_use, attachments   ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:
‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞ (PostgreSQL)
‚úÖ –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Ç–æ–≤
‚úÖ –ö–∞–∂–¥—ã–π —á–∞—Ç = –Ω–æ–≤–æ–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –æ–∫–Ω–æ (–ø—Ä–æ–±–ª–µ–º–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∞)
‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä—ã–º —Ä–∞–∑–≥–æ–≤–æ—Ä–∞–º
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (—á–µ—Ä–µ–∑ –ë–î)
‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–æ–∏—Å–∫)
```

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: Supabase** ‚≠ê

**–ü–æ—á–µ–º—É Supabase:**
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier: 500MB –ë–î, 2GB transfer/–º–µ—Å—è—Ü, unlimited API requests
- ‚úÖ PostgreSQL –∏–∑ –∫–æ—Ä–æ–±–∫–∏ (production-ready)
- ‚úÖ Real-time subscriptions (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è live updates)
- ‚úÖ Row Level Security (RLS) –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Next.js
- ‚úÖ Auth –∏–∑ –∫–æ—Ä–æ–±–∫–∏ (–¥–ª—è –±—É–¥—É—â–µ–π multi-user —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)
- ‚úÖ Dashboard –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ Automatic backups –Ω–∞ –ø–ª–∞—Ç–Ω—ã—Ö –ø–ª–∞–Ω–∞—Ö

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
1. **Vercel Postgres** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Vercel, –Ω–æ –ø–ª–∞—Ç–Ω—ã–π –ø–æ—Å–ª–µ free tier
2. **PlanetScale** - MySQL, serverless, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ setup
3. **Neon** - serverless Postgres, —Ö–æ—Ä–æ—à–∏–π free tier
4. **LocalStorage** - ‚ùå –ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–µ—Ç sync)

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- `@supabase/supabase-js` - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è JS/TS
- `@supabase/ssr` - –¥–ª—è server-side —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≤ Next.js

### State Management
- React Context API –∏–ª–∏ Zustand (–¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–∞—Ç–∞)
- AI SDK useChat —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `id` (–¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ chat_id)

---

## üìÖ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Phase 5: –ú—É–ª—å—Ç–∏—á–∞—Ç (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è MVP)

#### **5.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase** (30 –º–∏–Ω)

**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ [supabase.com](https://supabase.com)
2. –ü–æ–ª—É—á–∏—Ç—å API credentials (URL, anon key)
3. –î–æ–±–∞–≤–∏—Ç—å –≤ .env.local:
   ```
   NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJxxx...
   ```
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   npm install @supabase/supabase-js @supabase/ssr
   ```
5. –°–æ–∑–¥–∞—Ç—å `lib/supabase.ts` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è browser
6. –°–æ–∑–¥–∞—Ç—å `lib/supabase-server.ts` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è server-side

**–§–∞–π–ª—ã:**
- `lib/supabase.ts`
- `lib/supabase-server.ts`
- `.env.example` (–æ–±–Ω–æ–≤–∏—Ç—å —Å Supabase credentials)

---

#### **5.2 –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î** (20 –º–∏–Ω)

**SQL –º–∏–≥—Ä–∞—Ü–∏—è:**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ —á–∞—Ç–æ–≤
CREATE TABLE chats (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title TEXT NOT NULL DEFAULT '–ù–æ–≤—ã–π —á–∞—Ç',
  user_id UUID, -- –¥–ª—è –±—É–¥—É—â–µ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ø–æ–∫–∞ NULL)
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
CREATE TABLE messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  chat_id UUID NOT NULL REFERENCES chats(id) ON DELETE CASCADE,
  role TEXT NOT NULL CHECK (role IN ('user', 'assistant', 'system')),
  content TEXT NOT NULL,
  metadata JSONB DEFAULT '{}', -- –¥–ª—è tool_use, attachments, etc.
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_messages_chat_id ON messages(chat_id);
CREATE INDEX idx_messages_created_at ON messages(created_at DESC);
CREATE INDEX idx_chats_created_at ON chats(created_at DESC);

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_chats_updated_at
  BEFORE UPDATE ON chats
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();

-- Row Level Security (–ø–æ–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–æ, –≤–∫–ª—é—á–∏–º –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ auth)
ALTER TABLE chats ENABLE ROW LEVEL SECURITY;
ALTER TABLE messages ENABLE ROW LEVEL SECURITY;

-- –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞: –≤—Å–µ –º–æ–≥—É—Ç –≤—Å—ë (–ø–æ–∫–∞ –Ω–µ—Ç auth)
CREATE POLICY "Allow all for now" ON chats FOR ALL USING (true);
CREATE POLICY "Allow all for now" ON messages FOR ALL USING (true);
```

**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä—ã—Ç—å Supabase Dashboard ‚Üí SQL Editor
2. –í—Å—Ç–∞–≤–∏—Ç—å SQL –≤—ã—à–µ
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å (RUN)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ Table Editor

---

#### **5.3 API –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —á–∞—Ç–æ–≤** (45 –º–∏–Ω)

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:**

##### `app/api/chats/route.ts` - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase-server';

// GET /api/chats - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
export async function GET(req: NextRequest) {
  try {
    const supabase = createClient();

    const { data: chats, error } = await supabase
      .from('chats')
      .select('id, title, created_at, updated_at')
      .order('updated_at', { ascending: false });

    if (error) throw error;

    return NextResponse.json({ chats });
  } catch (error) {
    console.error('Error fetching chats:', error);
    return NextResponse.json(
      { error: 'Failed to fetch chats' },
      { status: 500 }
    );
  }
}

// POST /api/chats - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç
export async function POST(req: NextRequest) {
  try {
    const supabase = createClient();
    const { title } = await req.json();

    const { data: chat, error } = await supabase
      .from('chats')
      .insert({ title: title || '–ù–æ–≤—ã–π —á–∞—Ç' })
      .select()
      .single();

    if (error) throw error;

    return NextResponse.json({ chat });
  } catch (error) {
    console.error('Error creating chat:', error);
    return NextResponse.json(
      { error: 'Failed to create chat' },
      { status: 500 }
    );
  }
}
```

##### `app/api/chats/[id]/route.ts` - –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —á–∞—Ç–æ–º

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase-server';

// GET /api/chats/:id - –ü–æ–ª—É—á–∏—Ç—å —á–∞—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
export async function GET(
  req: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const supabase = createClient();
    const { id } = params;

    // –ü–æ–ª—É—á–∏—Ç—å —á–∞—Ç
    const { data: chat, error: chatError } = await supabase
      .from('chats')
      .select('*')
      .eq('id', id)
      .single();

    if (chatError) throw chatError;

    // –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
    const { data: messages, error: messagesError } = await supabase
      .from('messages')
      .select('*')
      .eq('chat_id', id)
      .order('created_at', { ascending: true });

    if (messagesError) throw messagesError;

    return NextResponse.json({ chat, messages });
  } catch (error) {
    console.error('Error fetching chat:', error);
    return NextResponse.json(
      { error: 'Failed to fetch chat' },
      { status: 500 }
    );
  }
}

// PATCH /api/chats/:id - –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞
export async function PATCH(
  req: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const supabase = createClient();
    const { id } = params;
    const { title } = await req.json();

    const { data: chat, error } = await supabase
      .from('chats')
      .update({ title })
      .eq('id', id)
      .select()
      .single();

    if (error) throw error;

    return NextResponse.json({ chat });
  } catch (error) {
    console.error('Error updating chat:', error);
    return NextResponse.json(
      { error: 'Failed to update chat' },
      { status: 500 }
    );
  }
}

// DELETE /api/chats/:id - –£–¥–∞–ª–∏—Ç—å —á–∞—Ç
export async function DELETE(
  req: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const supabase = createClient();
    const { id } = params;

    // –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ –ë–î (ON DELETE CASCADE)
    const { error } = await supabase.from('chats').delete().eq('id', id);

    if (error) throw error;

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('Error deleting chat:', error);
    return NextResponse.json(
      { error: 'Failed to delete chat' },
      { status: 500 }
    );
  }
}
```

---

#### **5.4 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Chat API** (30 –º–∏–Ω)

**–ò–∑–º–µ–Ω–∏—Ç—å `app/api/chat/route.ts`:**

```typescript
import { streamText, convertToModelMessages } from 'ai';
import { createAnthropic } from '@ai-sdk/anthropic';
import { createClient } from '@/lib/supabase-server';

const anthropic = createAnthropic({
  apiKey: process.env.ANTHROPIC_API_KEY || '',
});

export const runtime = 'edge';

export async function POST(req: Request) {
  try {
    const { messages, chatId } = await req.json();

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!messages || !Array.isArray(messages)) {
      return new Response('Invalid request: messages array required', {
        status: 400,
      });
    }

    if (!chatId) {
      return new Response('Invalid request: chatId required', {
        status: 400,
      });
    }

    const supabase = createClient();

    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å user message –≤ –ë–î
    const userMessage = messages[messages.length - 1];
    if (userMessage.role === 'user') {
      await supabase.from('messages').insert({
        chat_id: chatId,
        role: 'user',
        content: userMessage.parts[0].text,
      });
    }

    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å UI messages –≤ model messages
    const modelMessages = convertToModelMessages(messages);

    // Stream chat completion
    const result = streamText({
      model: anthropic('claude-sonnet-4-20250514'),
      messages: modelMessages,
      maxTokens: 4096,
      temperature: 1,
      // Callback –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è assistant message –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
      onFinish: async ({ text }) => {
        await supabase.from('messages').insert({
          chat_id: chatId,
          role: 'assistant',
          content: text,
        });

        // –û–±–Ω–æ–≤–∏—Ç—å updated_at —á–∞—Ç–∞
        await supabase
          .from('chats')
          .update({ updated_at: new Date().toISOString() })
          .eq('id', chatId);
      },
    });

    // Return UI message stream response
    return result.toUIMessageStreamResponse();
  } catch (error) {
    console.error('Error in chat API:', error);

    return new Response(
      JSON.stringify({
        error: 'Failed to process chat request',
        details: error instanceof Error ? error.message : 'Unknown error',
      }),
      {
        status: 500,
        headers: { 'Content-Type': 'application/json' },
      }
    );
  }
}
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `chatId` –≤ –∑–∞–ø—Ä–æ—Å–µ
2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ user message –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π Claude
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ assistant response —á–µ—Ä–µ–∑ `onFinish` callback
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `updated_at` —á–∞—Ç–∞ (–¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤ —Å–ø–∏—Å–∫–µ)

---

#### **5.5 –°–æ–∑–¥–∞–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** (60 –º–∏–Ω)

##### **5.5.1 Sidebar –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** (25 –º–∏–Ω)

**–°–æ–∑–¥–∞—Ç—å `components/Sidebar.tsx`:**

```typescript
'use client';

import { useState, useEffect } from 'react';
import { PlusIcon, TrashIcon } from '@heroicons/react/24/outline'; // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

interface Chat {
  id: string;
  title: string;
  created_at: string;
  updated_at: string;
}

interface SidebarProps {
  currentChatId: string | null;
  onSelectChat: (chatId: string) => void;
  onNewChat: () => void;
}

export default function Sidebar({
  currentChatId,
  onSelectChat,
  onNewChat,
}: SidebarProps) {
  const [chats, setChats] = useState<Chat[]>([]);
  const [loading, setLoading] = useState(true);

  // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
  useEffect(() => {
    fetchChats();
  }, []);

  const fetchChats = async () => {
    try {
      const response = await fetch('/api/chats');
      const data = await response.json();
      setChats(data.chats || []);
    } catch (error) {
      console.error('Failed to fetch chats:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (chatId: string, e: React.MouseEvent) => {
    e.stopPropagation(); // –ù–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –Ω–∞ —á–∞—Ç –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏

    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —á–∞—Ç?')) return;

    try {
      await fetch(`/api/chats/${chatId}`, { method: 'DELETE' });
      setChats((prev) => prev.filter((chat) => chat.id !== chatId));

      // –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π
      if (chatId === currentChatId) {
        onNewChat();
      }
    } catch (error) {
      console.error('Failed to delete chat:', error);
    }
  };

  return (
    <div className="w-64 bg-gray-900 text-white h-screen flex flex-col">
      {/* Header */}
      <div className="p-4 border-b border-gray-700">
        <button
          onClick={onNewChat}
          className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors"
        >
          <PlusIcon className="w-5 h-5" />
          <span>–ù–æ–≤—ã–π —á–∞—Ç</span>
        </button>
      </div>

      {/* Chat List */}
      <div className="flex-1 overflow-y-auto">
        {loading ? (
          <div className="p-4 text-gray-400 text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        ) : chats.length === 0 ? (
          <div className="p-4 text-gray-400 text-center text-sm">
            –ù–µ—Ç —á–∞—Ç–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π!
          </div>
        ) : (
          <div className="py-2">
            {chats.map((chat) => (
              <div
                key={chat.id}
                onClick={() => onSelectChat(chat.id)}
                className={`px-4 py-3 cursor-pointer hover:bg-gray-800 transition-colors flex items-center justify-between group ${
                  chat.id === currentChatId ? 'bg-gray-800' : ''
                }`}
              >
                <div className="flex-1 truncate">
                  <div className="text-sm font-medium truncate">
                    {chat.title}
                  </div>
                  <div className="text-xs text-gray-400">
                    {new Date(chat.updated_at).toLocaleDateString('ru-RU')}
                  </div>
                </div>
                <button
                  onClick={(e) => handleDelete(chat.id, e)}
                  className="opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-700 rounded transition-opacity"
                  aria-label="–£–¥–∞–ª–∏—Ç—å —á–∞—Ç"
                >
                  <TrashIcon className="w-4 h-4 text-gray-400" />
                </button>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* Footer (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) */}
      <div className="p-4 border-t border-gray-700 text-xs text-gray-400">
        <div>NegotiateAI Chatbot</div>
        <div>–í—Å–µ–≥–æ —á–∞—Ç–æ–≤: {chats.length}</div>
      </div>
    </div>
  );
}
```

---

##### **5.5.2 ChatWindow –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** (20 –º–∏–Ω)

**–°–æ–∑–¥–∞—Ç—å `components/ChatWindow.tsx`:**

```typescript
'use client';

import { useChat } from '@ai-sdk/react';
import { useState, useEffect } from 'react';

interface ChatWindowProps {
  chatId: string;
}

export default function ChatWindow({ chatId }: ChatWindowProps) {
  const { messages, sendMessage, status, error } = useChat({
    api: '/api/chat',
    body: { chatId }, // –ü–µ—Ä–µ–¥–∞—ë–º chatId –≤ API
  });
  const [input, setInput] = useState('');
  const [initialLoading, setInitialLoading] = useState(true);

  // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ —Å–º–µ–Ω–µ —á–∞—Ç–∞
  useEffect(() => {
    loadChatHistory();
  }, [chatId]);

  const loadChatHistory = async () => {
    try {
      setInitialLoading(true);
      const response = await fetch(`/api/chats/${chatId}`);
      const data = await response.json();

      // TODO: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å useChat —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
      // –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ AI SDK –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ —Å–ø–æ—Å–æ–±–∞,
      // –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å initialMessages prop –∏–ª–∏ state management

      // –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∂–µ–º –ø—É—Å—Ç–æ–π —á–∞—Ç
      // –í production –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Zustand –∏–ª–∏ Context
    } catch (error) {
      console.error('Failed to load chat history:', error);
    } finally {
      setInitialLoading(false);
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!input.trim()) return;

    const userMessage = input;
    setInput('');
    await sendMessage({
      role: 'user',
      parts: [{ type: 'text', text: userMessage }],
    });
  };

  const isLoading = status === 'submitted' || status === 'streaming';

  if (initialLoading) {
    return (
      <div className="flex-1 flex items-center justify-center bg-gray-50">
        <div className="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞...</div>
      </div>
    );
  }

  return (
    <div className="flex-1 flex flex-col h-screen bg-gray-50">
      {/* Header */}
      <header className="bg-white border-b border-gray-200 px-6 py-4">
        <h1 className="text-xl font-semibold text-gray-900">
          NegotiateAI Chatbot
        </h1>
        <p className="text-sm text-gray-500">
          AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤ –ø–æ –ø—Ä–æ–µ–∫—Ç—É MIR.TRADE
        </p>
      </header>

      {/* Messages Container */}
      <div className="flex-1 overflow-y-auto px-6 py-4 space-y-4">
        {messages.length === 0 && (
          <div className="flex items-center justify-center h-full">
            <div className="text-center text-gray-500">
              <p className="text-lg font-medium mb-2">–ù–∞—á–Ω–∏—Ç–µ —Ä–∞–∑–≥–æ–≤–æ—Ä</p>
              <p className="text-sm">–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ –ø—Ä–æ–µ–∫—Ç–µ MIR.TRADE</p>
            </div>
          </div>
        )}

        {messages.map((message) => (
          <div
            key={message.id}
            className={`flex ${
              message.role === 'user' ? 'justify-end' : 'justify-start'
            }`}
          >
            <div
              className={`max-w-[70%] rounded-lg px-4 py-3 ${
                message.role === 'user'
                  ? 'bg-blue-600 text-white'
                  : 'bg-white text-gray-900 border border-gray-200'
              }`}
            >
              <div className="text-sm whitespace-pre-wrap">
                {message.parts.map((part, index) => {
                  if (part.type === 'text') {
                    return <span key={index}>{part.text}</span>;
                  }
                  return null;
                })}
              </div>
            </div>
          </div>
        ))}

        {isLoading && (
          <div className="flex justify-start">
            <div className="max-w-[70%] rounded-lg px-4 py-3 bg-white text-gray-900 border border-gray-200">
              <div className="flex space-x-2">
                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"></div>
                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"></div>
              </div>
            </div>
          </div>
        )}

        {error && (
          <div className="flex justify-center">
            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
              <p className="text-sm">
                –û—à–∏–±–∫–∞: {error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞'}
              </p>
            </div>
          </div>
        )}
      </div>

      {/* Input Form */}
      <div className="bg-white border-t border-gray-200 px-6 py-4">
        <form onSubmit={handleSubmit} className="flex space-x-4">
          <input
            value={input}
            onChange={(e) => setInput(e.target.value)}
            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
            disabled={isLoading}
            className="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"
          />
          <button
            type="submit"
            disabled={isLoading || !input.trim()}
            className="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
          >
            {isLoading ? '–û—Ç–ø—Ä–∞–≤–∫–∞...' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å'}
          </button>
        </form>
      </div>
    </div>
  );
}
```

---

##### **5.5.3 –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** (15 –º–∏–Ω)

**–û–±–Ω–æ–≤–∏—Ç—å `app/page.tsx`:**

```typescript
'use client';

import { useState, useEffect } from 'react';
import Sidebar from '@/components/Sidebar';
import ChatWindow from '@/components/ChatWindow';

export default function HomePage() {
  const [currentChatId, setCurrentChatId] = useState<string | null>(null);

  // –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç
  useEffect(() => {
    if (!currentChatId) {
      createNewChat();
    }
  }, []);

  const createNewChat = async () => {
    try {
      const response = await fetch('/api/chats', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title: '–ù–æ–≤—ã–π —á–∞—Ç' }),
      });
      const data = await response.json();
      setCurrentChatId(data.chat.id);
    } catch (error) {
      console.error('Failed to create new chat:', error);
    }
  };

  return (
    <div className="flex h-screen">
      <Sidebar
        currentChatId={currentChatId}
        onSelectChat={setCurrentChatId}
        onNewChat={createNewChat}
      />
      {currentChatId ? (
        <ChatWindow key={currentChatId} chatId={currentChatId} />
      ) : (
        <div className="flex-1 flex items-center justify-center bg-gray-50">
          <div className="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
      )}
    </div>
  );
}
```

---

#### **5.6 –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π —á–∞—Ç–æ–≤** (20 –º–∏–Ω)

**–°–æ–∑–¥–∞—Ç—å `lib/generate-chat-title.ts`:**

```typescript
import Anthropic from '@anthropic-ai/sdk';

const anthropic = new Anthropic({
  apiKey: process.env.ANTHROPIC_API_KEY || '',
});

export async function generateChatTitle(
  firstUserMessage: string
): Promise<string> {
  try {
    const response = await anthropic.messages.create({
      model: 'claude-sonnet-4-20250514',
      max_tokens: 50,
      messages: [
        {
          role: 'user',
          content: `–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–æ—Ä–æ—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (3-5 —Å–ª–æ–≤) –¥–ª—è —á–∞—Ç–∞, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ —ç—Ç–æ–º –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

"${firstUserMessage}"

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –∑–∞–≥–æ–ª–æ–≤–æ–∫, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤.`,
        },
      ],
    });

    const title = response.content[0].text.trim();
    return title || '–ù–æ–≤—ã–π —á–∞—Ç';
  } catch (error) {
    console.error('Failed to generate chat title:', error);
    return '–ù–æ–≤—ã–π —á–∞—Ç';
  }
}
```

**–û–±–Ω–æ–≤–∏—Ç—å `app/api/chat/route.ts`:**

```typescript
import { generateChatTitle } from '@/lib/generate-chat-title';

// –í —Ñ—É–Ω–∫—Ü–∏–∏ POST, –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ user message:

const userMessage = messages[messages.length - 1];
if (userMessage.role === 'user') {
  const { data: insertedMessage } = await supabase
    .from('messages')
    .insert({
      chat_id: chatId,
      role: 'user',
      content: userMessage.parts[0].text,
    })
    .select()
    .single();

  // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å title
  const { count } = await supabase
    .from('messages')
    .select('id', { count: 'exact', head: true })
    .eq('chat_id', chatId);

  if (count === 1) {
    // –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º title –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
    generateChatTitle(userMessage.parts[0].text).then(async (title) => {
      await supabase.from('chats').update({ title }).eq('id', chatId);
    });
  }
}
```

---

#### **5.7 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (30 –º–∏–Ω)

**–¢–µ—Å—Ç-–∫–µ–π—Å—ã:**

1. **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞**
   - –ö–ª–∏–∫ –Ω–∞ "–ù–æ–≤—ã–π —á–∞—Ç"
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é title

2. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏**
   - –°–æ–∑–¥–∞—Ç—å 3 —á–∞—Ç–∞
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–∂–¥—ã–π
   - –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏–∏

3. **–£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞**
   - –£–¥–∞–ª–∏—Ç—å —á–∞—Ç
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ë–î (Supabase Dashboard)

4. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —á–∞—Ç–æ–≤**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å—Ç–∞—Ä—ã–π —á–∞—Ç
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–Ω –ø–æ–¥–Ω—è–ª—Å—è –Ω–∞–≤–µ—Ä—Ö —Å–ø–∏—Å–∫–∞

5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
   - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —á–∞—Ç—ã –∏ –∏—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å

6. **–î–ª–∏–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å 20+ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ–¥–∏–Ω —á–∞—Ç
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–∏–ª—Å—è (–∫–∞–∂–¥—ã–π —á–∞—Ç = –Ω–æ–≤–æ–µ –æ–∫–Ω–æ)

---

#### **5.8 –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (15 –º–∏–Ω)

**–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:**

1. **README.md:**
   - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Supabase setup
   - –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –û–±–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã (—Å —Å–∞–π–¥–±–∞—Ä–æ–º)

2. **docs/architecture.md:**
   - –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É —Å Supabase
   - –û–ø–∏—Å–∞—Ç—å —Å—Ö–µ–º—É –ë–î
   - –û–ø–∏—Å–∞—Ç—å flow —Å–æ–∑–¥–∞–Ω–∏—è/–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —á–∞—Ç–æ–≤

3. **docs/setup.md:**
   - –®–∞–≥–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Supabase
   - SQL –º–∏–≥—Ä–∞—Ü–∏—è
   - –ü–æ–ª—É—á–µ–Ω–∏–µ credentials

4. **CHANGELOG.md:**
   - –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é —Å –º—É–ª—å—Ç–∏—á–∞—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, v0.4.0)

---

## ‚è±Ô∏è –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

| –ó–∞–¥–∞—á–∞ | –í—Ä–µ–º—è | –î–µ—Ç–∞–ª–∏ |
|--------|-------|--------|
| 5.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase | 30 –º–∏–Ω | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, credentials, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ |
| 5.2 –°—Ö–µ–º–∞ –ë–î | 20 –º–∏–Ω | SQL –º–∏–≥—Ä–∞—Ü–∏—è, –∏–Ω–¥–µ–∫—Å—ã, RLS |
| 5.3 API –º–∞—Ä—à—Ä—É—Ç—ã | 45 –º–∏–Ω | /api/chats CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| 5.4 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Chat API | 30 –º–∏–Ω | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π |
| 5.5 UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | 60 –º–∏–Ω | Sidebar (25–º), ChatWindow (20–º), Page (15–º) |
| 5.6 –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è title | 20 –º–∏–Ω | Claude API –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π |
| 5.7 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 30 –º–∏–Ω | –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ |
| 5.8 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 15 –º–∏–Ω | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ README, architecture |
| **–ò–¢–û–ì–û** | **3 —á–∞—Å–∞ 30 –º–∏–Ω** | |

**–° –∑–∞–ø–∞—Å–æ–º –Ω–∞ –±–∞–≥–∏:** ~4 —á–∞—Å–∞

---

## üö® –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –ü—Ä–æ–±–ª–µ–º—ã —Å Supabase RLS
**–û–ø–∏—Å–∞–Ω–∏–µ:** Row Level Security –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–í–ª–∏—è–Ω–∏–µ:** –í—ã—Å–æ–∫–æ–µ (–Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ù–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É "Allow all"
- –í–∫–ª—é—á–∏—Ç—å —Å—Ç—Ä–æ–≥–∏–µ RLS —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ Supabase Dashboard

### –†–∏—Å–∫ 2: –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î –Ω–∞ free tier
**–û–ø–∏—Å–∞–Ω–∏–µ:** Supabase free tier - 500MB
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (–¥–ª—è MVP)
**–í–ª–∏—è–Ω–∏–µ:** –°—Ä–µ–¥–Ω–µ–µ
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ë–î –≤ Supabase Dashboard
- –ü—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –ª–∏–º–∏—Ç—É - –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö —á–∞—Ç–æ–≤
- –ò–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω ($25/–º–µ—Å)

### –†–∏—Å–∫ 3: useChat –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∏—Å—Ç–æ—Ä–∏–∏
**–û–ø–∏—Å–∞–Ω–∏–µ:** AI SDK useChat –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ existing messages
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è
**–í–ª–∏—è–Ω–∏–µ:** –°—Ä–µ–¥–Ω–µ–µ
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Zustand/Context –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è messages state
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å initialMessages prop (–µ—Å–ª–∏ –¥–æ–±–∞–≤—è—Ç –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö)
- –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å—Ç–∞—Ä—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –ë–î

### –†–∏—Å–∫ 4: Race conditions –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
**–û–ø–∏—Å–∞–Ω–∏–µ:** Streaming response –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Ä–∞–Ω—å—à–µ —á–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è user message
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–í–ª–∏—è–Ω–∏–µ:** –ù–∏–∑–∫–æ–µ
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å await –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ user message
- onFinish callback –¥–ª—è assistant message (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ë–î

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã
- API routes (jest + msw)
- Supabase –∫–ª–∏–µ–Ω—Ç (mock)
- generateChatTitle —Ñ—É–Ω–∫—Ü–∏—è

### Integration —Ç–µ—Å—Ç—ã
- –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î
- –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è messages
- –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è title

### E2E —Ç–µ—Å—Ç—ã (Playwright)
- User journey: —Å–æ–∑–¥–∞—Ç—å —á–∞—Ç ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è ‚Üí –≤–µ—Ä–Ω—É—Ç—å—Å—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ refresh
- –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è —á–∞—Ç–∞

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –°—Ü–µ–Ω–∞—Ä–∏–π: –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É–∂–µ –µ—Å—Ç—å —á–∞—Ç—ã –≤ localStorage

**–ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏:**

1. **–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
   - –ï—Å–ª–∏ –µ—Å—Ç—å - –ø–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª–∫—É: "–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —á–∞—Ç—ã –≤ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É?"

2. **–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≥–ª–∞—Å–∏–ª—Å—è:**
   - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç –≤ Supabase
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ localStorage –≤ –ë–î
   - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å title –¥–ª—è —á–∞—Ç–∞
   - –û—á–∏—Å—Ç–∏—Ç—å localStorage
   - –ü–æ–∫–∞–∑–∞—Ç—å success —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

3. **–ï—Å–ª–∏ –æ—Ç–∫–∞–∑–∞–ª—Å—è:**
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–ª–∞–≥ –≤ localStorage: `migration_declined`
   - –ë–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–æ–¥–∞–ª–∫—É
   - –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ localStorage (–Ω–µ —Ç—Ä–æ–≥–∞–µ–º)

**–ö–æ–¥ –º–∏–≥—Ä–∞—Ü–∏–∏:**

```typescript
// lib/migrate-from-localstorage.ts
export async function migrateFromLocalStorage() {
  const oldMessages = localStorage.getItem('chat_messages');
  if (!oldMessages) return null;

  const messages = JSON.parse(oldMessages);
  if (messages.length === 0) return null;

  // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç
  const response = await fetch('/api/chats', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title: '–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —á–∞—Ç' }),
  });
  const { chat } = await response.json();

  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  for (const message of messages) {
    await fetch('/api/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: chat.id,
        role: message.role,
        content: message.content,
      }),
    });
  }

  // –û—á–∏—Å—Ç–∏—Ç—å localStorage
  localStorage.removeItem('chat_messages');

  return chat.id;
}
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –º—É–ª—å—Ç–∏—á–∞—Ç–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤** (avg per user)
2. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ —á–∞—Ç** (–ø–æ–∫–∞–∑–∞—Ç–µ–ª—å engagement)
3. **–ß–∞—Å—Ç–æ—Ç–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏** (–ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏)
4. **–ß–∞—Å—Ç–æ—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–∞—Ç–æ–≤** (–µ—Å–ª–∏ –≤—ã—Å–æ–∫–∞—è - UX –ø—Ä–æ–±–ª–µ–º–∞)
5. **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–∞** (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å <500ms)
6. **–†–∞–∑–º–µ—Ä –ë–î** (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ free tier –ª–∏–º–∏—Ç–∞)

---

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (Phase 6+)

### –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –º—É–ª—å—Ç–∏—á–∞—Ç–∞:

1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (Firebase Auth / Supabase Auth)
   - –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google/Email
   - Row Level Security –≤ Supabase
   - –õ–∏—á–Ω—ã–µ —á–∞—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **–ü–æ–∏—Å–∫ –ø–æ —á–∞—Ç–∞–º**
   - Full-text search –≤ PostgreSQL
   - –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏–π

3. **–≠–∫—Å–ø–æ—Ä—Ç —á–∞—Ç–∞**
   - –°–∫–∞—á–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ PDF/TXT
   - –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π –Ω–∞ —á–∞—Ç (–ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø)

4. **–ü–∞–ø–∫–∏/—Ç–µ–≥–∏ –¥–ª—è —á–∞—Ç–æ–≤**
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º (–ï–≥–∏–ø–µ—Ç, –ê–ª–∂–∏—Ä, –û–ê–≠...)
   - –¢–µ–≥–∏: "—Ç–µ–Ω–¥–µ—Ä", "–∫–æ–º–º–µ—Ä—Ü–∏—è", "—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è"

5. **–ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö —á–∞—Ç–æ–≤**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏–≤–∞—Ü–∏—è —á–µ—Ä–µ–∑ 90 –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   - –ü–µ—Ä–µ–Ω–æ—Å –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É (—ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞)

6. **–ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å**
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ —á–∞—Ç (PDF, DOCX, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
   - Claude –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ attachments –≤ Supabase Storage

7. **Collaborative —Ä–µ–∂–∏–º**
   - –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –æ–¥–Ω–æ–º —á–∞—Ç–µ
   - Real-time updates —á–µ—Ä–µ–∑ Supabase Realtime

8. **–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥**
   - Speech-to-text –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
   - Text-to-speech –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ Claude

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –Ω–∞—á–∞—Ç—å Phase 5, —É–±–µ–¥–∏—Å—å —á—Ç–æ:**

- [ ] Phase 1-4 (MVP) –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] read_document, web_search, get_current_date —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- [ ] –£ —Ç–µ–±—è –µ—Å—Ç—å ~4 —á–∞—Å–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –°–æ–∑–¥–∞–Ω –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ supabase.com
- [ ] –ü–æ–Ω–∏–º–∞–µ—à—å –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç PostgreSQL (–±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å)
- [ ] –ü–æ–Ω–∏–º–∞–µ—à—å –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç React hooks (useEffect, useState)
- [ ] –ï—Å—Ç—å –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üéØ Success Criteria –¥–ª—è Phase 5

**–°—á–∏—Ç–∞–µ–º Phase 5 –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π –∫–æ–≥–¥–∞:**

- [ ] Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω, –ë–î —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Ç–æ–≤
- [ ] –°–∞–π–¥–±–∞—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
- [ ] –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∏—Å—Ç–æ—Ä–∏–∏
- [ ] –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ Supabase Dashboard)
- [ ] –ü–æ—Å–ª–µ refresh —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Å–µ —á–∞—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ
- [ ] –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —á–∞—Ç
- [ ] –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –ß–∞—Ç—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ updated_at (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–∞–≤–µ—Ä—Ö—É)
- [ ] –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

**Supabase:**
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://supabase.com/docs)
- [Next.js integration](https://supabase.com/docs/guides/getting-started/quickstarts/nextjs)
- [Row Level Security guide](https://supabase.com/docs/guides/auth/row-level-security)

**AI SDK:**
- [useChat documentation](https://ai-sdk.dev/docs/reference/ai-sdk-ui/use-chat)
- [streamText reference](https://ai-sdk.dev/docs/reference/ai-sdk-core/stream-text)

**UI Inspiration:**
- [ChatGPT](https://chat.openai.com) - –¥–ª—è UX –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- [Claude.ai](https://claude.ai) - –¥–ª—è —Å–∞–π–¥–±–∞—Ä–∞ –∏ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤

---

## üí° –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º—É–ª—å—Ç–∏—á–∞—Ç–∞ - —ç—Ç–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞—è —Ñ–∏—á–∞** –¥–ª—è production —Å–∏—Å—Ç–µ–º—ã NegotiateAI Chatbot. –û–Ω–∞ —Ä–µ—à–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ UX –ø—Ä–æ–±–ª–µ–º—É, –Ω–æ –∏ **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** (–∫–∞–∂–¥—ã–π —á–∞—Ç = –Ω–æ–≤–æ–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –æ–∫–Ω–æ).

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

1. ‚úÖ **Phase 0-1:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è + –ë–∞–∑–æ–≤—ã–π —á–∞—Ç (–∑–∞–≤–µ—Ä—à–µ–Ω–æ)
2. ‚è≥ **Phase 2-3:** –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π + AI tools (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
3. ‚è≥ **Phase 4:** –ü–æ–ª–∏—Ä–æ–≤–∫–∞ MVP
4. üîú **Phase 5:** –ú—É–ª—å—Ç–∏—á–∞—Ç (—ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç)
5. üîÆ **Phase 6+:** –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –ø–æ–∏—Å–∫, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏—á–∏

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º—É–ª—å—Ç–∏—á–∞—Ç–∞:**
- ‚úÖ –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚úÖ –£–ª—É—á—à–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é —Ä–∞–±–æ—Ç—ã (—Ä–∞–∑–Ω—ã–µ —á–∞—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –Ω–∞–≤—Å–µ–≥–¥–∞ (PostgreSQL)
- ‚úÖ –ü—Ä–∏–≤—ã—á–Ω—ã–π UX –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤

**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ~4 —á–∞—Å–∞
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** High (–ø–æ—Å–ª–µ MVP)

---

**–ê–≤—Ç–æ—Ä:** Claude Code
**–î–∞—Ç–∞:** 2025-10-14
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
