# Техническое задание: NegotiateAI Chatbot

## Описание проекта

Разработать веб-чат-бот **NegotiateAI Assistant** для ведения переговоров по проекту **MIR.TRADE**. Бот создан специально для обсуждения этого проекта на базе большой неструктурированной документации заказчика. Бот должен анализировать документы, находить информацию и давать обоснованные ответы со ссылками на источники.

---

## Tech Stack

- **Framework**: Next.js (через Vercel AI Chatbot Template)
- **LLM**: Claude Sonnet 4.5 через Anthropic API (напрямую)
- **Search**: Brave Search API
- **Deployment**: Vercel
- **База знаний**: Оригинальные файлы в репозитории (DOCX, PDF)

---

## Архитектура проекта

### 1. Базовая структура

```
/
├── app/                    # Next.js app directory
├── components/             # React компоненты чата
├── lib/                    # Утилиты и конфигурация
├── knowledge/              # База знаний (оригинальные документы)
│   ├── Алжир/
│   ├── Египет/
│   ├── Иран/
│   ├── Китай/
│   ├── ОАЭ/
│   ├── Оман/
│   ├── Сирия/
│   ├── Тунис/
│   ├── Турция/
│   └── [корневые файлы - DOCX, PDF]
├── index.md               # Индексный файл базы знаний
├── system-prompt.md       # Системный промпт
├── .env.local             # API ключи (не коммитить!)
└── package.json
```

**Примечание**: 
- Папка `/knowledge` содержит **оригинальные документы** (DOCX, PDF)
- Claude Sonnet 4.5 через Anthropic API умеет читать эти форматы напрямую
- Конвертация в .txt **не требуется**

### 2. Входные данные (будут предоставлены)

- **system-prompt.md** - полный системный промпт со всей логикой работы бота
- **index.md** - структурированный индекс всех документов с описаниями (будет встроен в system-prompt.md)
- **Папка /knowledge** - оригинальные документы (DOCX, PDF) из папки MIR.TRADE
- **Anthropic API key**
- **Brave Search API key**

**Примечание**: `system-prompt.md` уже содержит место для вставки `index.md`. При инициализации бота нужно:
1. Прочитать содержимое `index.md`
2. Вставить его в соответствующее место в `system-prompt.md` (там есть маркер `[ИНДЕКСНЫЙ ФАЙЛ index.md ВСТАВЛЯЕТСЯ СЮДА]`)
3. Использовать получившийся полный промпт

---

## Функциональные требования

### Core функционал

1. **Веб-интерфейс чата**
   - Стандартный UI чата с полем ввода и историей сообщений
   - Streaming ответов (текст появляется по мере генерации)
   - Markdown рендеринг в ответах
   - Адаптивный дизайн (desktop + mobile)

2. **System Prompt с базой знаний**
   - **ВАЖНО**: Полный system prompt предоставлен в отдельном файле `system-prompt.md`
   - Этот промпт содержит:
     * Роль и философию работы агента
     * Полное содержимое `index.md` (индексная база данных)
     * Детальные инструкции по использованию всех функций
     * Специальные сценарии работы и примеры
     * Стратегии создания "вау-эффекта"
   - Используй содержимое `system-prompt.md` полностью, без изменений
   - Это критически важный файл - вся логика работы бота в нём

3. **Функции/Tools для агента**

   **a) read_document(filepath)**
   - Параметр: `filepath` (string) - путь к файлу относительно папки `/knowledge`
   - Поддерживаемые форматы: `.docx`, `.pdf`, `.txt`
   - Логика: читает документ из `/knowledge/{filepath}` через Anthropic API
   - Возвращает: содержимое документа как string (Anthropic API автоматически извлекает текст)
   - Обработка ошибок: если файл не найден или не поддерживается, вернуть сообщение об ошибке

   **b) web_search(query)**
   - Параметр: `query` (string) - поисковый запрос
   - Логика: вызов Brave Search API
   - Возвращает: топ 5-10 результатов поиска (title, snippet, url)
   - Обработка ошибок: если API недоступен, сообщить об этом

   **c) get_current_date()**
   - Параметры: нет
   - Логика: возвращает текущую дату и время
   - Формат: ISO 8601 или "14 октября 2025 г."
   - Включает: дату, день недели, время

### Интеграции

1. **OpenRouter API**
   - Model: `anthropic/claude-sonnet-4.5-20250929`
   - Endpoint: `https://openrouter.ai/api/v1/chat/completions`
   - Поддержка function calling
   - Streaming responses

2. **Brave Search API**
   - Endpoint: `https://api.search.brave.com/res/v1/web/search`
   - Бесплатный tier (2000 запросов/месяц)
   - Обработка rate limits

---

## System Prompt

**ВАЖНО**: Полный system prompt предоставляется в отдельном файле `system-prompt.md`.

Этот файл содержит:
- Детальное описание роли и философии работы бота
- Полный индекс документации (содержимое index.md)
- Подробные инструкции по всем функциям и сценариям работы
- Примеры создания "вау-эффекта" для демонстрации силы AI
- Специальные стратегии для помощи в переговорах
- Форматирование ответов и стиль коммуникации

**Для разработчика:**
- Используй содержимое `system-prompt.md` целиком как system prompt
- Не изменяй и не сокращай его - там критическая логика работы
- Файл уже готов к использованию, просто загрузи его содержимое

---

## Технические требования

### Environment Variables
```
ANTHROPIC_API_KEY=sk-ant-...
BRAVE_SEARCH_API_KEY=BSA...
```

### Package dependencies (основные)
- next
- react
- ai (Vercel AI SDK)
- @anthropic-ai/sdk (официальный Anthropic SDK)
- fs/path (встроенные Node.js)

### Конфигурация OpenRouter
- Headers: `Authorization: Bearer ${OPENROUTER_API_KEY}`
- Model: `anthropic/claude-sonnet-4.5-20250929`
- Temperature: 0.7 (можно настроить)
- Max tokens: 4096
- Function calling: enabled

### Обработка ошибок
- API rate limits - показать пользователю сообщение
- Файл не найден - сообщить и предложить проверить индекс
- Ошибки сети - retry с экспоненциальным backoff
- Таймауты - 60 секунд для LLM, 10 секунд для поиска

---

## UI/UX требования

### Минимальная кастомизация
- **Название**: "NegotiateAI Assistant"
- **Описание под заголовком**: "Ассистент для переговоров по проекту MIR.TRADE"
- **Цвета**: дефолтные из template (или нейтральная профессиональная палитра)
- **Placeholder**: "Задайте вопрос о проекте MIR.TRADE..."

### Опционально (если время)
- Индикатор использования функций ("Читаю документ...", "Ищу в интернете...")
- Копирование ответов в буфер
- Очистка истории чата

---

## Деплой

### Vercel
1. Подключить GitHub репозиторий к Vercel
2. Добавить environment variables в настройках Vercel
3. Auto-deploy при push в main
4. Проверить работу всех функций в продакшене

### Важно
- `/knowledge` папка должна быть включена в деплой
- `index.md` и `system-prompt.md` должны быть доступны для чтения
- **Документы в оригинальном формате** (DOCX, PDF) - конвертация не требуется
- Anthropic API читает документы напрямую

---

## Критерии приемки

### Must have
✅ Чат-бот работает через веб-интерфейс  
✅ Агент читает и анализирует документы из `/knowledge`  
✅ Веб-поиск работает и возвращает актуальные результаты  
✅ Агент знает текущую дату и время  
✅ Ответы содержат ссылки на источники  
✅ Streaming ответов работает  
✅ Задеплоено на Vercel и доступно по ссылке  

### Nice to have
- Индикаторы работы функций
- Экспорт переписки
- История сессий

---

## Примечания для разработчика

1. **Начни с Vercel AI Chatbot Template** - fork/clone готового репозитория

2. **System Prompt - это ключ к успеху**
   - Файл `system-prompt.md` содержит всю логику работы бота
   - Прочитай его внимательно перед началом разработки
   - Вставь содержимое `index.md` в маркер `[ИНДЕКСНЫЙ ФАЙЛ index.md ВСТАВЛЯЕТСЯ СЮДА]`
   - Используй получившийся полный промпт без изменений

3. **Используй официальный Anthropic SDK** - `@anthropic-ai/sdk`

4. **Чтение документов через Anthropic API**
   - Claude Sonnet 4.5 умеет читать PDF и DOCX напрямую
   - Передавай файлы через Messages API с соответствующим MIME типом
   - Не нужна конвертация в текст

5. **Vercel AI SDK** - имеет встроенную поддержку Anthropic и function calling

6. **Тестируй каждую функцию отдельно** - сначала read_document, потом web_search, потом всё вместе

7. **System prompt может быть большим** - Claude Sonnet 4.5 имеет контекст 200K токенов

8. **index.md и system-prompt.md будут предоставлены** - просто используй их содержимое

9. **Vercel деплой в США** - Anthropic API работает без VPN, никаких проблем с доступом

---

## Приоритеты разработки

**Phase 1: Базовый чат**
- Деплой template
- Подключение OpenRouter
- Базовый system prompt

**Phase 2: База знаний**
- Интеграция index.md в промпт
- Функция read_document
- Тестирование чтения файлов

**Phase 3: Дополнительный функционал**
- Brave Search интеграция
- get_current_date функция
- Финальная настройка промпта

**Phase 4: Полировка**
- UI кастомизация
- Обработка ошибок
- Финальное тестирование

---

## Контакты и вопросы

Если что-то неясно или нужны уточнения по:
- Структуре index.md
- Формату документов в /knowledge
- Деталям промпта
- API ключам

Связаться для уточнений перед началом кодинга.

---

**Дедлайн**: Быстрая реализация (цель: завершить за 2-4 часа работы)

**Результат**: Ссылка на работающий чат-бот на Vercel