# Custom Features –¥–ª—è NegotiateAI Chatbot

> **–¶–µ–ª—å:** –û–ø–∏—Å–∞—Ç—å –ß–¢–û –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫ —á–∏—Å—Ç–æ–º—É Vercel AI Chatbot Template –¥–ª—è –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ñ–∏—á, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –±–∞–∑–æ–≤—ã–π template.

---

## üéØ –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ Vercel AI Chatbot Template

‚úÖ **Authentication** (Auth.js)
‚úÖ **Database** (PostgreSQL —á–µ—Ä–µ–∑ Vercel)
‚úÖ **–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤** (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î)
‚úÖ **Streaming –æ—Ç–≤–µ—Ç–æ–≤** (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏)
‚úÖ **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** (–≥–æ—Ç–æ–≤—ã–π –¥–∏–∑–∞–π–Ω)
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤** (OpenAI, Anthropic –∏ –¥—Ä.)

**–ù–ï –¢–†–û–ì–ê–ï–ú!** –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å.

---

## ‚ûï –ß—Ç–æ –Ω—É–∂–Ω–æ –î–û–ë–ê–í–ò–¢–¨

### 1. Anthropic Provider Configuration

**–§–∞–π–ª:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–≤–æ–∑–º–æ–∂–Ω–æ `lib/ai/providers.ts` –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–π)

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Anthropic –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- –ú–æ–¥–µ–ª—å: `claude-sonnet-4-20250514`
- API Key: –∏–∑ `ANTHROPIC_API_KEY` environment variable

**–ü—Ä–∏–º–µ—Ä (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ):**
```typescript
const anthropic = createAnthropic({
  apiKey: process.env.ANTHROPIC_API_KEY,
});

const model = anthropic('claude-sonnet-4-20250514');
```

---

### 2. System Prompt Integration

**–§–∞–π–ª:** –ì–¥–µ template –∑–∞–≥—Ä—É–∂–∞–µ—Ç system prompt

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
1. –ó–∞–≥—Ä—É–∂–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ `system-prompt.md` —Ñ–∞–π–ª–∞
2. –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `index.md` –≤ –º–∞—Ä–∫–µ—Ä `[–ò–ù–î–ï–ö–°–ù–´–ô –§–ê–ô–õ index.md –í–°–¢–ê–í–õ–Ø–ï–¢–°–Ø –°–Æ–î–ê]`
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è –ø–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç

**–õ–æ–≥–∏–∫–∞:**
```typescript
async function getSystemPrompt(): Promise<string> {
  const promptTemplate = await fs.readFile('system-prompt.md', 'utf-8');
  const indexContent = await fs.readFile('index.md', 'utf-8');

  return promptTemplate.replace(
    '[–ò–ù–î–ï–ö–°–ù–´–ô –§–ê–ô–õ index.md –í–°–¢–ê–í–õ–Ø–ï–¢–°–Ø –°–Æ–î–ê]',
    indexContent
  );
}
```

**–§–∞–π–ª—ã:**
- `system-prompt.md` - –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–º–ø—Ç (—É–∂–µ –≥–æ—Ç–æ–≤)
- `index.md` - –∏–Ω–¥–µ–∫—Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (~25 –∏–∑ 102 –æ–ø–∏—Å–∞–Ω–æ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ TODO)

---

### 3. Custom AI Tools (Functions)

**–§–∞–π–ª:** –°–æ–∑–¥–∞—Ç—å `lib/tools/` –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É tools template

#### Tool 1: read_document

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ß—Ç–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ –ø–∞–ø–∫–∏ `knowledge/`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `filepath` (string) - –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ `knowledge/`, –Ω–∞–ø—Ä–∏–º–µ—Ä: `"knowledge/–ê–ª–∂–∏—Ä/—Ç–µ–Ω–¥–µ—Ä–Ω—ã–µ –ø–ª–æ—â–∞–¥–∫–∏ –ê–ª–∂–∏—Ä–∞.docx"`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø—Ä—è–º–æ–π Anthropic SDK** (@anthropic-ai/sdk)
- –ß–∏—Ç–∞—Ç—å DOCX/PDF —á–µ—Ä–µ–∑ Anthropic Document API (–Ω–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)
- –ù–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ TXT!

**–†–µ—Ñ–µ—Ä–µ–Ω—Å:** –°–º. `–¢–µ—Ö–∑–∞–¥–∞–Ω–∏–µ /negotiateai-tech-spec.md` —Ä–∞–∑–¥–µ–ª "–§—É–Ω–∫—Ü–∏–∏/Tools"

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ):**
```typescript
import Anthropic from '@anthropic-ai/sdk';

const anthropic = new Anthropic({
  apiKey: process.env.ANTHROPIC_API_KEY,
});

async function readDocument(filepath: string) {
  // 1. Validate path starts with 'knowledge/'
  // 2. Read file as base64
  // 3. Determine MIME type (.pdf, .docx, etc.)
  // 4. Send to Anthropic Messages API with document block
  // 5. Return extracted text
}
```

**–í–∞–∂–Ω–æ:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ –∏–∑ `knowledge/`)
- –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (30MB)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .pdf, .docx, .doc, .txt, .csv, .html

#### Tool 2: get_current_date

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –Ω–µ—Ç

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
function getCurrentDate() {
  return new Date().toISOString();
  // –∏–ª–∏: return new Date().toLocaleString('ru-RU', {...});
}
```

**–ó–∞—á–µ–º:** –î–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ —Å—Ä–æ–∫–∞–º —Ç–µ–Ω–¥–µ—Ä–æ–≤, –¥–µ–¥–ª–∞–π–Ω–∞–º –∏ —Ç.–¥.

#### Tool 3: web_search (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û - Phase 3)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–∏—Å–∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Brave Search API

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (string) - –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- Brave Search API: `https://api.search.brave.com/res/v1/web/search`
- API Key: –∏–∑ `BRAVE_SEARCH_API_KEY` environment variable
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–æ–ø 5-10 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```typescript
{
  results: [
    { title: '...', snippet: '...', url: '...' },
    // ...
  ]
}
```

---

### 4. UI Customization

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**

#### –ë—Ä–µ–Ω–¥–∏–Ω–≥
- **–ù–∞–∑–≤–∞–Ω–∏–µ:** "NegotiateAI Assistant"
- **–û–ø–∏—Å–∞–Ω–∏–µ:** "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤ –ø–æ –ø—Ä–æ–µ–∫—Ç—É MIR.TRADE"
- **Placeholder:** "–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ –ø—Ä–æ–µ–∫—Ç–µ MIR.TRADE..."

#### Tool Usage Indicators (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å:
- "–ß–∏—Ç–∞—é –¥–æ–∫—É–º–µ–Ω—Ç..." (read_document)
- "–ò—â—É –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ..." (web_search)
- "–ü–æ–ª—É—á–∞—é —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É..." (get_current_date)

**–ì–¥–µ:** –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ —á–∞—Ç–∞, –≥–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è "thinking" –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

---

## üì¶ –ß—Ç–æ –ù–ï —Ç—Ä–æ–≥–∞–µ–º (–æ—Å—Ç–∞–≤–ª—è–µ–º –∏–∑ template)

‚ùå **–ù–ï —Ç—Ä–æ–≥–∞–π:**
- Authentication —Å–∏—Å—Ç–µ–º—É
- Database —Å—Ö–µ–º—É (Postgres)
- UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å)
- Routing —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- API endpoints —Å—Ç—Ä—É–∫—Ç—É—Ä—É

‚úÖ **–¢–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ–º:**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Anthropic –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- System prompt –∑–∞–≥—Ä—É–∑–∫—É
- 3 custom tools
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±—Ä–µ–Ω–¥–∏–Ω–≥ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ)

---

## üóÇÔ∏è –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—á—Ç–æ –¥–æ–±–∞–≤–∏—Ç—Å—è)

```
/
‚îú‚îÄ‚îÄ knowledge/              # –ì–û–¢–û–í–û - –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (~102 –¥–æ–∫—É–º–µ–Ω—Ç–∞)
‚îú‚îÄ‚îÄ system-prompt.md        # –ì–û–¢–û–í–û - —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
‚îú‚îÄ‚îÄ index.md                # –í –ü–†–û–¶–ï–°–°–ï - –∏–Ω–¥–µ–∫—Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (25/102)
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ tools/              # –°–û–ó–î–ê–¢–¨
‚îÇ       ‚îú‚îÄ‚îÄ read-document.ts   # Tool 1
‚îÇ       ‚îú‚îÄ‚îÄ get-current-date.ts # Tool 2
‚îÇ       ‚îî‚îÄ‚îÄ web-search.ts      # Tool 3 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ [–æ—Å—Ç–∞–ª—å–Ω–æ–µ –∏–∑ template]
```

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Phase 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Anthropic –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ system-prompt.md + –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ index.md
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π —á–∞—Ç (–±–µ–∑ tools)

### Phase 2: Custom Tools
- [ ] –î–æ–±–∞–≤–∏—Ç—å read_document tool
- [ ] –î–æ–±–∞–≤–∏—Ç—å get_current_date tool
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤ tools

### Phase 3: –î–æ–ø. —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å web_search tool
- [ ] Tool usage indicators –≤ UI

### Phase 4: –ë—Ä–µ–Ω–¥–∏–Ω–≥
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ "NegotiateAI Assistant"
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å placeholder
- [ ] –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üîó –†–µ—Ñ–µ—Ä–µ–Ω—Å—ã

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è:**
- `–¢–µ—Ö–∑–∞–¥–∞–Ω–∏–µ /negotiateai-tech-spec.md` - –ø–æ–ª–Ω–æ–µ —Ç–µ—Ö–∑–∞–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- `–¢–µ—Ö–∑–∞–¥–∞–Ω–∏–µ /index-file-specification.md` - —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è index.md

**–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç:**
- `system-prompt.md` - –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç (–∏—Å–ø–æ–ª—å–∑—É–π –∫–∞–∫ –µ—Å—Ç—å!)
- `index.md` - –∏–Ω–¥–µ–∫—Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—á–∞—Å—Ç–∏—á–Ω–æ –≥–æ—Ç–æ–≤)

**–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π:**
- `knowledge/` - ~102 –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö DOCX/PDF
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: 17 –ø–∞–ø–æ–∫ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º + –∫–æ—Ä–Ω–µ–≤—ã–µ —Ñ–∞–π–ª—ã

---

## üí° –í–∞–∂–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ú–∏–Ω–∏–º—É–º –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ template** - —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ–º, –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º
2. **–ò—Å–ø–æ–ª—å–∑—É–π —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** - –µ—Å–ª–∏ –µ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∞ tools, –∏—Å–ø–æ–ª—å–∑—É–π –µ—ë
3. **–ù–µ –¥—É–±–ª–∏—Ä—É–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª** - –µ—Å–ª–∏ –≤ template –µ—Å—Ç—å auth, –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ
4. **–°–ª–µ–¥—É–π —Å—Ç–∏–ª—é –∫–æ–¥–∞ template** - TypeScript, file structure, naming

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-10-14
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Vercel AI Chatbot Template
