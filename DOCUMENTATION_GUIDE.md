# Руководство по ведению документации проекта NegotiateAI

> **Важно:** Этот документ описывает правила и принципы ведения документации.
> При любых изменениях в проекте следуй этим правилам!

---

## 🚨 ОБЯЗАТЕЛЬНОЕ ПРАВИЛО ДЛЯ ВСЕХ ИЗМЕНЕНИЙ

### После ЛЮБЫХ значительных изменений документация ОБЯЗАНА быть обновлена!

**Что считается "значительными изменениями":**
- ✅ Создание новых компонентов, API routes, функций
- ✅ Изменение архитектуры проекта
- ✅ Добавление или удаление зависимостей (package.json)
- ✅ Изменение API endpoints
- ✅ Изменение структуры папок
- ✅ Добавление новых AI tools (функций агента)
- ✅ Изменение переменных окружения (.env)
- ✅ Изменение базы знаний (knowledge/)
- ✅ Изменение system-prompt.md или index.md
- ✅ Добавление новых интеграций (API)

**Что нужно сделать:**
1. ✅ Обновить все файлы документации согласно правилам SSOT
2. ✅ Пройти чек-лист (см. раздел "Чек-лист при изменениях")
3. ✅ Проверить, что нигде нет дублирования информации
4. ✅ Обновить CHANGELOG.md
5. ✅ Проверить актуальность README.md

**Это НЕ рекомендация, это ОБЯЗАТЕЛЬНОЕ требование!**

> 💡 Неактуальная документация хуже, чем отсутствие документации.
> Всегда обновляй документы после изменений!

---

## 🎯 Принципы документации

### 1. Single Source of Truth (SSOT)
- Каждая информация живёт в ОДНОМ месте
- Остальные файлы ссылаются на неё
- Обновил в одном месте → везде актуально

**Пример:**
- ❌ Неправильно: Писать список функций в README, docs/api/tools.md, и docs/architecture.md
- ✅ Правильно: Детальное описание в docs/api/tools.md, остальные файлы ссылаются

### 2. README = Точка входа
- **Размер:** 90-120 строк (не больше!)
- **Содержание:** Только быстрый старт
- **Детали:** Ссылки на docs/ для подробностей
- **Назначение:** Дать понять что это за проект и как быстро запустить

### 3. docs/ = Детали
- Детальная установка → `docs/setup.md`
- Архитектура → `docs/architecture.md`
- Deployment → `docs/deployment.md`
- Troubleshooting → `docs/troubleshooting.md`
- API docs → `docs/api/`
- ADR → `docs/decisions/`

### 4. Не дублируй информацию!
- Если нужно повторить - сделай ссылку
- Один источник правды = легче обновлять

---

## 📁 Обязательная структура файлов

```
negotiateai-chatbot/
│
├── README.md ──────────────────────► ТОЧКА ВХОДА (90-120 строк)
│                                     • Что это (2-3 предложения)
│                                     • Быстрый старт (команды)
│                                     • Функции бота (краткий список)
│                                     • Ссылки на docs/
│                                     • Технологии (кратко)
│
├── CHANGELOG.md ───────────────────► ИСТОРИЯ ИЗМЕНЕНИЙ
│                                     • Semantic Versioning
│                                     • [Unreleased] - что в работе
│                                     • [0.1.0] - что релизнули
│
├── DOCUMENTATION_GUIDE.md ─────────► ЭТОТ ФАЙЛ (правила!)
│                                     • Как вести документацию
│                                     • Принципы SSOT
│                                     • Чек-листы
│
├── .env.example ───────────────────► ШАБЛОН ПЕРЕМЕННЫХ
│                                     • ANTHROPIC_API_KEY
│                                     • BRAVE_SEARCH_API_KEY
│                                     • Комментарии где получить
│
├── .gitignore ─────────────────────► ЧТО НЕ КОММИТИТЬ
│                                     • .env.local (ОБЯЗАТЕЛЬНО!)
│                                     • node_modules
│                                     • .next
│
├── app/                            # Next.js app directory
├── components/                     # React компоненты
├── lib/                            # API интеграции и утилиты
│
├── knowledge/                      # База знаний (DOCX, PDF)
├── index.md                        # Индекс базы знаний
├── system-prompt.md                # Системный промпт
│
└── docs/ ──────────────────────────► ДЕТАЛЬНАЯ ДОКУМЕНТАЦИЯ
    │
    ├── setup.md ───────────────────► ДЕТАЛЬНАЯ УСТАНОВКА
    │                                 • Prerequisites
    │                                 • Получение API ключей
    │                                 • npm install
    │                                 • Первый запуск
    │                                 • Тестирование функций
    │
    ├── architecture.md ────────────► АРХИТЕКТУРА СИСТЕМЫ
    │                                 • Общая схема (ASCII)
    │                                 • Слои приложения
    │                                 • Function calling flow
    │                                 • Как работает read_document
    │                                 • System prompt integration
    │
    ├── deployment.md ──────────────► ДЕПЛОЙ НА VERCEL
    │                                 • Подготовка репозитория
    │                                 • Создание проекта в Vercel
    │                                 • Environment variables
    │                                 • Проверка работы
    │                                 • Troubleshooting деплоя
    │
    ├── troubleshooting.md ─────────► ПРОБЛЕМЫ И РЕШЕНИЯ
    │                                 • Установка и настройка
    │                                 • API и интеграции
    │                                 • Чтение документов
    │                                 • Веб-поиск
    │                                 • Streaming
    │                                 • Production
    │
    ├── api/ ───────────────────────► API ДОКУМЕНТАЦИЯ
    │   ├── tools.md                • Детальное описание 3 функций
    │   │                            - read_document(filepath)
    │   │                            - web_search(query)
    │   │                            - get_current_date()
    │   │
    │   └── anthropic.md            • Настройка Anthropic API
    │                                • Function calling
    │                                • Streaming
    │
    ├── decisions/ ─────────────────► ADR (Architecture Decision Records)
    │   ├── template.md             • Шаблон для новых ADR
    │   ├── 001-why-anthropic-direct.md
    │   ├── 002-why-nextjs.md
    │   └── 003-no-vector-db.md
    │
    └── images/ ────────────────────► ДИАГРАММЫ (если нужны)
        └── architecture.png
```

---

## 📝 Шаблоны файлов

### README.md (90-120 строк)

```markdown
# NegotiateAI Assistant

AI-ассистент для ведения переговоров по проекту MIR.TRADE.

## Быстрый старт

### 1. Установка
```bash
npm install
```

### 2. Настройка .env.local
```bash
cp .env.example .env.local
# Отредактируй .env.local (добавь API ключи)
```

### 3. Запуск
```bash
npm run dev
```

Открой http://localhost:3000

## Функции бота

- read_document - Чтение документов из базы знаний
- web_search - Поиск актуальной информации
- get_current_date - Получение текущей даты

## Документация

- [Детальная установка](docs/setup.md)
- [Архитектура](docs/architecture.md)
- [Деплой на Vercel](docs/deployment.md)
- [Troubleshooting](docs/troubleshooting.md)

## Технологии

- Next.js 14
- Claude Sonnet 4.5 (Anthropic API)
- Brave Search API

## Лицензия

MIT
```

**Ключевые моменты:**
- ✅ Компактный (90-120 строк)
- ✅ Только быстрый старт
- ✅ Ссылки на docs/ для деталей
- ✅ Не дублирует детальные инструкции

---

### CHANGELOG.md

```markdown
# Changelog

Формат: [Semantic Versioning](https://semver.org/)

## [Unreleased]

### Planned
- Инициализация Next.js проекта
- Интеграция Anthropic API
- Реализация 3 функций агента

## [0.1.0] - 2025-10-14

### Added
- Структура документации проекта
- README.md с быстрым стартом
- .env.example с шаблоном переменных
- docs/ папка с детальной документацией
```

**Обновляй после каждого значительного изменения!**

---

### docs/decisions/template.md (ADR)

```markdown
# ADR XXX: [Название решения]

**Дата:** YYYY-MM-DD
**Статус:** Принято | Отклонено | Устарело

---

## Контекст

Опиши проблему или вопрос.

## Решение

Что решили делать.

## Причины

1. Причина 1
2. Причина 2

## Последствия

**Плюсы:**
- Плюс 1

**Минусы:**
- Минус 1

## Альтернативы

Что ещё рассматривали и почему отклонили.
```

---

## ✅ Чек-лист при изменениях

### Когда меняешь проект:

**1. Добавил новую функцию агента (AI tool)?**
- [ ] Обнови список функций в README.md (краткий)
- [ ] Детально опиши в docs/api/tools.md
- [ ] Обнови docs/architecture.md (если меняет flow)
- [ ] Добавь в CHANGELOG.md
- [ ] Обнови system-prompt.md (инструкции для Claude)

**2. Изменил базу знаний (knowledge/)?**
- [ ] Обнови index.md (если добавил/удалил документы)
- [ ] Проверь docs/architecture.md (размер базы актуален?)
- [ ] Обнови CHANGELOG.md

**3. Добавил зависимость?**
- [ ] npm install (обновится package.json автоматически)
- [ ] Упомяни в docs/setup.md (если важная зависимость)
- [ ] Обнови раздел "Технологии" в README (если критичная)

**4. Изменил переменные окружения?**
- [ ] Обнови .env.example (без реальных значений!)
- [ ] Обнови docs/setup.md (инструкция как получить ключ)
- [ ] Проверь docs/deployment.md (нужно ли обновить?)

**5. Изменил API endpoints?**
- [ ] Обнови docs/architecture.md
- [ ] Добавь в CHANGELOG.md
- [ ] Проверь docs/deployment.md (влияет на production?)

**6. Добавил новую страницу/route?**
- [ ] Обнови структуру проекта в README (если важна)
- [ ] Опиши в docs/architecture.md

**7. Изменил system-prompt.md или index.md?**
- [ ] Опиши изменение в CHANGELOG.md
- [ ] Проверь docs/architecture.md (актуален раздел про system prompt?)

**8. Создал новый ADR?**
- [ ] Добавь ссылку в README (раздел "Архитектурные решения")
- [ ] Упомяни в docs/architecture.md (если релевантно)

---

## ⚠️ Что НЕЛЬЗЯ делать

❌ **НЕ создавай дублирующие файлы:**
- Нет QUICKSTART.md (если есть README)
- Нет PROJECT_SUMMARY.md (если есть README + docs/)
- Нет README в подпапках (app/README.md, components/README.md)
- Нет дублирующих гайдов (INSTALLATION.md дублирует docs/setup.md)

❌ **НЕ копируй информацию:**
- Вместо копирования делай ссылку
- Один источник правды!

**Примеры:**
```markdown
# ❌ Неправильно (дублирование)
README.md: "Функция read_document читает DOCX и PDF..."
docs/api/tools.md: "Функция read_document читает DOCX и PDF..."

# ✅ Правильно (ссылка)
README.md: "- read_document - Чтение документов (см. docs/api/tools.md)"
docs/api/tools.md: [Детальное описание read_document]
```

❌ **НЕ делай README длинным:**
- Максимум 120 строк
- Детали → в docs/

❌ **НЕ забывай обновлять:**
- Изменил код → обнови документацию
- Нашел баг → добавь в docs/troubleshooting.md
- Добавил фичу → обнови CHANGELOG.md

❌ **НЕ коммить секреты:**
- Никогда не коммить .env.local
- Только .env.example (без реальных значений)
- API ключи ТОЛЬКО в .env.local

---

## 💡 Главное правило

> **Документация пишется ОДИН РАЗ правильно, обновляется при каждом изменении проекта.**

### Процесс:
1. Создаешь базовую структуру (по шаблонам выше)
2. При каждом изменении обновляешь нужные файлы
3. Следуешь принципу SSOT
4. Проверяешь чек-лист
5. Коммитишь код + обновлённую документацию вместе

### Если не знаешь куда добавить информацию:
- **Быстрый старт?** → README.md
- **Детальная инструкция?** → docs/setup.md
- **Как работает?** → docs/architecture.md
- **Как задеплоить?** → docs/deployment.md
- **Что-то не работает?** → docs/troubleshooting.md
- **Детали функций?** → docs/api/tools.md
- **Важное решение?** → docs/decisions/NNN-название.md
- **История изменений?** → CHANGELOG.md

---

## 🔍 Как проверить SSOT

### Команды для поиска дублирования:

```bash
# Найти все README файлы (должен быть только один в корне)
find . -name "README.md" -not -path "./node_modules/*"

# Найти все .md файлы в корне
ls *.md

# Найти дублирование информации (например, "read_document")
grep -r "read_document" *.md docs/

# Найти упоминания переменной окружения
grep -r "ANTHROPIC_API_KEY" .

# Найти упоминания версии/числа
grep -r "Claude Sonnet 4.5" .
```

### Признаки нарушения SSOT:
- ⚠️ Одна и та же информация в разных файлах (полностью скопирована)
- ⚠️ Несколько README.md в разных папках
- ⚠️ Файлы типа QUICKSTART.md, GETTING_STARTED.md дублируют README
- ⚠️ Числа/факты различаются в разных местах
- ⚠️ Список функций есть и в README, и в docs/, и оба детальные

---

## 📚 Примеры правильной документации

### ✅ Правильно (SSOT):

**README.md:**
```markdown
## Функции бота

- read_document - Чтение документов
- web_search - Поиск информации
- get_current_date - Получение даты

Детальное описание в [docs/api/tools.md](docs/api/tools.md).
```

**docs/api/tools.md:**
```markdown
# AI Agent Tools

## 1. read_document(filepath)

### Описание
Читает документ из папки knowledge/...

### Parameters
- filepath: string

### Примеры
...
[10+ страниц детального описания]
```

➡️ README - краткий список, docs/api/tools.md - детальное описание. Нет дублирования!

---

### ❌ Неправильно (дублирование):

**README.md:**
```markdown
## read_document(filepath)

Читает документ из папки knowledge/.

### Parameters
- filepath: string - путь к файлу

### Примеры
read_document("file.docx")
...
```

**docs/api/tools.md:**
```markdown
## read_document(filepath)

Читает документ из папки knowledge/.

### Parameters
- filepath: string - путь к файлу

### Примеры
read_document("file.docx")
...
```

➡️ Полное дублирование! В README должна быть только ссылка на docs/.

---

## 🎯 Специфика проекта NegotiateAI

### Ключевые файлы проекта:

**1. knowledge/** - база знаний
- Оригинальные DOCX/PDF документы
- Структура по странам
- НЕ коммитить если файлы > 50MB (Vercel limit)

**2. index.md** - индекс базы знаний
- Список всех документов с описаниями
- Встраивается в system-prompt.md
- Обновляй при добавлении/удалении документов

**3. system-prompt.md** - системный промпт
- Роль и инструкции для Claude
- Содержит placeholder для index.md
- Критически важный файл

**4. lib/** - бизнес-логика
- anthropic.ts - Anthropic API client
- brave-search.ts - Brave Search integration
- tools.ts - реализация 3 функций

### Когда обновлять документацию:

**Изменения в knowledge/:**
```bash
# Добавил документы
1. Обнови index.md
2. Добавь в CHANGELOG.md
3. Проверь docs/architecture.md (размер базы)
```

**Изменения в system-prompt.md:**
```bash
1. Добавь в CHANGELOG.md
2. Проверь docs/architecture.md (если логика изменилась)
```

**Добавил новую функцию (tool):**
```bash
1. Реализуй в lib/tools.ts
2. Добавь в список tools в lib/anthropic.ts
3. Обнови README.md (краткий список)
4. Детально опиши в docs/api/tools.md
5. Обнови docs/architecture.md (function calling flow)
6. Добавь в system-prompt.md (инструкции для Claude)
7. Добавь в CHANGELOG.md
```

---

## 🎓 Итог

**Запомни:**
1. **SSOT** - один источник правды
2. **README** - 90-120 строк
3. **docs/** - детали
4. **Ссылки**, не копирование
5. **Обновляй** при изменениях
6. **Следуй шаблонам**
7. **Проверяй чек-лист**

**Этот файл - твой гайд. Обращайся к нему при любых изменениях документации!**

---

## 📞 Вопросы?

Если не уверен как организовать документацию:
1. Прочитай этот файл ещё раз
2. Посмотри на примеры выше
3. Следуй принципу SSOT
4. В случае сомнений - спроси перед изменением

**Лучше спросить один раз, чем переделывать документацию потом.**
